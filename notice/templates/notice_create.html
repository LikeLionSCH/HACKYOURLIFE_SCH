{% extends 'base.html' %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/notice_create.css' %}">
{% endblock %}

{% block title %}
<title>멋쟁이사자처럼 at 순천향대학교 - Gallery</title>
{% endblock %}

{% block content %}

    <main>

        <!-- 서브 타이틀 필요 하신분은 그대로 쓰시고 아니면 지우시고 하시면 됩니다. -->
        <div class='title-wrap'>
            <span class='page-sub-title'>
                NOTICE
            </span>
        </div>

        <!-- form -->

        <div class="main-wrap">
            <form class="form-box" action="{% url 'notice_create' %}" method="post">
                {% csrf_token %}
                <div class="title-box">
                    <p>제목</p>
                    <input type="text" name="title" placeholder="공지사항 제목">
                </div>
                <div class="date-box">
                    <p>공지사항 일시</p>
                    <input type="date" name="date">
                </div>
                <div class="explanation-box">
                    <p>공지사항 상세내용</p>
                    <textarea name="contents" cols="30" rows="10"></textarea>
                </div>
                <div>
                    첨부파일 : <input type="file" name="file">
                </div>

                <div>
                    첨부이미지 : <input type="file" name="image">
                </div>

                <input type="submit" value="공지사항 올리기">
            </form>
        </div>

        <!-- ------- -->

    </main>

{% endblock %}

{% block script %}
<script id="MainScript">
    var ImgName, ImgUrl;
    var files = [];
    var reader;

    if (!firebase.apps.length) {
        const firebaseConfig = {
            apiKey: "AIzaSyA3NMvkdpSoKYsPPkNgDtrppzurxOMJbQQ",
            authDomain: "likelion-sch.firebaseapp.com",
            databaseURL: "https://likelion-sch.firebaseio.com/",
            projectId: "likelion-sch",
            storageBucket: "likelion-sch.appspot.com",
            messagingSenderId: "654141769540",
            appId: "1:654141769540:web:c744ef4d2df58003093911",
            measurementId: "G-PXNX9ZZCEN"
        };

        firebase.initializeApp(firebaseConfig);
    }

    document.getElementById("select").onclick = function(e){
        var input = document.createElement('input');
        input.type='file';
        input.multiple='multiple';

        input.onchange = e => {
            files = e.target.files;
            reader = new FileReader();
            reader.onload = function(){
                document.getElementById("myimg").src = reader.result;
            }
            reader.readAsDataURL(files[0]);
        }
        input.click();


    }

    document.getElementById('upload').onclick = function(){
        ImgName = document.getElementById('namebox').value;
        var uploadTask = firebase.storage().ref('Images/'+ImgName+".png").put(files[0]);

        uploadTask.on('state_changed',function(snapshot){
            var progress = (snapshot.bytesTranferred / snapshot.totalBytes) * 100
            document.getElementById('UpProgress').innerHTML = 'Upload';
        },

        function(error){
            alert('error in saving the image');
        },

        function(){
            uploadTask.snapshot.ref.getDownloadURL().then(function(url){
                ImgUrl = url;
                document.getElementById('myimg-url').value = url;

                firebase.database().ref('Pictures/'+ImgName).set({
                    Name: ImgName,
                    Link: ImgUrl
                });
                alert("image upload success!");
            }
            );
    });

    document.getElementById('retrieve').onclick = function(){
        firebase.database().ref('Pictures/'+ImgName).on('value', function(snapshot){
            document.getElementById('myimg').src = snapshot.val.Link;
        });
    }
}
</script>
{% endblock %}